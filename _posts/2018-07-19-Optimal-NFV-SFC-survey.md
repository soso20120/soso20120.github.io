---
layout: post
title: Optimal Network Function Virtualization and Service Function Chaining：A Survey
date: 2018-07-19 09:09:33
excerpt: 
tags:
- NFV
- SFC

---

## <span class="tooltip" titles="Network Function Virtualization 网络功能虚拟化" >NFV</span>

![ETSI-nfv-architecture.JPG](/assets/img/ETSI-nfv-architecture.JPG)

#### NFVI

* 硬件资源：服务器和存储/网络设施
* 虚拟资源：虚拟机（VM），虚拟节点和虚拟链路

#### VNF

* VNF是在虚拟机上运行的网络功能的软件实例
* 单个VNF可以由部署在多个虚拟机上的多个子功能组成

#### MANO

MANO提供VNF的配置，并配置它们和相关的基础设施。包括三个部分：
* <span class="tooltip" titles="NFV orchestrator 协调器">NFVO</span>：负责创建端到端的服务，管理网络服务的生命周期。
	1. 在服务目录中注册网络服务及其所需参数和相关规则;
	2. 创建，查询，更新和删除转发规则和网络服务序列;
	3. 创建，扩展，更新和终止网络服务。
* <span class="tooltip" titles="Virtual network functions manager 虚拟网络功能管理器">VNFM</span>：负责管理VNF生命周期，包括创建，扩展，更新，升级和终止VNF。VNFM和EMS都被分配来管理VNF，因此它们之间的职责划分在不同的情况下可能会有所不同。
* <span class="tooltip" titles="Virtualized infrastructure manager 虚拟化基础架构管理器">VIM</span>:管理NFVI的资源，包括软件清单，资源分配，电源管理，资源回收，NFVI性能问题分析以及故障管理和性能优化等操作的数据收集。因为资源在多个用户服务之间共享，所以资源分配是一项复杂的任务，VIM必须处理竞争请求和约束。

#### <span class="tooltip" titles="Operations support system/Business support system 运营支持系统/业务支持系统">OSS/BSS</span>

* OSS/BSS提供管理系统，帮助服务提供商部署和管理端到端网络服务，与服务的订购、计费、、续订和故障排除有关。EMS提供OSS所需的信息。

## NFV应用场景

#### 虚拟中间件Virtualized middle-boxes

* 中间框是源和目标之间的路径上的任何中间节点，其提供除路由器的正常标准功能之外的功能，例如路由发现和路由选择。
* 一些常用的功能已经在Linux中实现。

#### 虚拟交换机和路由Virtualized switching and routing

* 已有一些交换机的开源软件。
* 路由虚拟化暂时还不会应用，因为无法满足高性能要求。
* 提供商边缘（PE）路由器和BRAS的虚拟化是可行的。

#### 虚拟访问网络元素

* 驻留在混合光纤DSL远程节点中要求紧凑、功耗低、维护成本低。通过虚拟化可能实现。
* 在任何企业或住宅宽带用户的客户端设备（CPE）也可以虚拟化。通过这种方式，CPE的许多功能被移动到运营商的网络位置，并且CPE就像连接到服务提供商网络的简单的第2层转发设备一样。

#### 移动核心网的虚拟化

* 移动网络的特点是各种各样的专有硬件设备，移动运营商可以使用NFV为其客户提供低成本的高质量服务。

#### 内容交付网络的虚拟化

* 在内容交付网络=中，常部署缓存节点以提高多媒体服务的质量。但是这会浪费专用资源，使用NFV可以优化。

#### 网络功能虚拟化即服务

* 服务提供商可以提供NFVI及其平台、VNF实例为服务，类似于云服务模型。

## <span class="tooltip" titles="Service Function Chaining 服务功能链" >SFC</span>

网络服务是网络运营商为用户提供的完整端到端功能。 它通常由几个按顺序链接的服务功能（SF）组成。例如，在“网络保护”服务中，所需的服务功能可以是防火墙，DPI和病毒扫描程序。在正式定义中，每个服务功能（也称为网络功能）负责对接收到的数据包进行特定处理。根据定义，服务功能链是一系列服务功能，必须根据分类和（或）策略的结果，以确定的顺序执行。服务功能链（SFC）就是构建服务功能链和引导转发数据包的机制。

![IETF-sfc-architecture.JPG](/assets/img/IETF-sfc-architecture.JPG)

#### 框架

* Management Plane：管理服务功能的安装，维护和终止。
* Data Plane：其中分类器在将流量转发到服务功能路径（SFP）之前对流量进行识别和分类。
* Control Plane：建立和管理分类器和服务功能之间的路径。首先，SFC控制器根据分类器分组的结果来生成或选择特定服务功能链。同时用户简档存储用户偏好和订阅信息。然后控制器参考两者，建立满足服务功能及其连接链路的容量和QoS要求的链路。之后将服务功能放置在网络中。最后，策略控制器用于维护表示转发路径的SFC策略表。

SDN是可以用在control plane的一种候选技术。在软件定义的网络中，集中控制实现网络切片，这意味着联合虚拟网络嵌入和资源分配。网络切片可用于控制服务功能链中的流路由。

网络切片是一种特定的虚拟化形式，允许多个逻辑网络在共享的物理网络基础设施之上运行。网络切片概念的关键优势在于它提供了一个端到端的虚拟网络，不仅包括网络，还包括计算和存储功能。目标是允许物理移动网络运营商划分其网络资源以允许不同的用户（所谓的租户）复用单个物理基础设施。

张等将此问题表述为混合二元线性程序，并提出了Penalty连续上限最小化（PSUM）算法，PSUMRounding（PSUM-R）算法和两种启发式算法来解决该问题。仿真结果表明PSUM和PSUM-R的解决方案接近最优解。另外，PSUM算法满足资源容量约束，而PSUM-R算法在解决方案质量和算法之间实现了良好的平衡效率。

#### SFC

* 服务功能链是由（部分）有序的网络功能组成的服务的表示。
* 最简单的服务功能链是端点之间服务功能的线性序列。
* 复杂的情况下，服务功能可以看作不同路径下的网络流，使用<span class="tooltip" titles="VNF Forwarding
graph VNF有向图">VNF-FG</span>描述，分为两部分：
	1. 节点：网络功能
	2. 边：点之间的连接

![examples-of-sfc.JPG](/assets/img/examples-of-sfc.JPG)

在端到端网络服务场景中，<span class="tooltip" titles="Service function path 服务功能路径">SFP</span>是服务功能实例（SFI）的有序列表。使用
<span class="tooltip" titles="Service function forwarders 服务功能转发器">SFF</span>作为中间转发元件，引导网络流量。为了引导流量沿着正确的路径，IETF建议使用包含服务路径信息的网络服务标头（NSH）。NSH由服务分类器添加，该分类器通过检查分组的报头和有效载荷来确定每个传入分组所需的SFP。NSH通过共享在节点之间传递的元数据来帮助实现拓扑独立性，并提供在分类器和SF之间以及SF之间交换上下文信息的能力。

#### SFC的四个阶段

第一个问题是如何描述服务的功能和非功能属性。服务描述定义了服务提供的内容及其使用方式。它包括服务接口，以及其使用的技术限制。此信息是部署服务并与之交互所必需的。

第二个问题是排序约束。虽然服务功能通常是独立的，但许多服务功能都有严格的排序，必须仔细考虑。因此，需要一种一致的方式来将服务功能的排序强加于服务链中。

另一方面，网络服务的部署耦合到网络拓扑。这意味着在最佳资源使用方面对服务链的一些限制; 因此，最优服务功能链中最重要的问题是有效的资源分配。此问题确定必须在哪些物理节点上放置VNF（部署），以及必须在何时执行它们（调度）。

* **<span class="tooltip" titles="Service chain Description">SC-D</span>**

因特网中用于服务描述的流行方法是使用Web服务描述语言（WSDL）或统一服务描述语言（USDL），旨在从业务，操作或技术角度描述Web和因特网服务。可用的服务描述语言不容易适应弹性服务环境，其中**更新服务链**是一项具有挑战性的任务。此外，SFC还有其他限制要求

  >1. 在描述云服务方面也做了大量工作。例如，云服务声明性定义语言（CSDL）侧重于云中服务的描述。
  2. Joseph和Stoica开发了一个模型来描述一些常见的网络功能的功能性，但它不适用于虚拟网络功能，因为它不考虑资源需求。
  3. YANG数据模型是NFV管理和编排模块中采用的一个很好的候选者。OpenDaylight SFC项目使用YANG数据模型来表示服务的结构及其要求。此外，ETSI还在其标准NFV架构中定义了一个用于MANO的YANG模型方案。
  4. Mehraghdam和Karl使用YANG模型描述服务结构。YANG数据建模语言旨在提供配置的分层模型，并为网络配置协议（NETCONF）提供运行时数据。它还支持不同格式的数据实例。在它的另一篇论文中，引入了无上下文语言，用于形式化链接请求。

* **<span class="tooltip" titles="Service chain Composition">SC-C</span>**

在NFV的上下文中，网络服务被定义为由有序的VNF列表组成的实体。SFC的第二步是如何根据请求有效地连接不同的VNF，以便以最合适的方式组成网络服务（VNF-FG），与请求者目标相关。

假设VNF2是一个负载均衡器，VNF3的输出流量是输入流量的150%。VNF之间存在依赖关系，此例中VNF2、VNF3、VNF4依赖于VNF1，VNF3必须在VNF2之后。不同的链组成会影响网络服务的性能，因此要在服务提供商的目标方面实现有效的服务链组合。
![sfc-composition.JPG](/assets/img/sfc-composition.JPG)

  >1. Mehraghdam等提出了一种用于chin composition的贪婪算法，目的是最小化所得链的总数据速率。算法的每一步都是先链接其输出与输入数据速率的比率较小的VNF。
  2. Beck和Botero提出了一种启发式算法，同时解决服务链的组合和放置。在每一步中，它在服务链中组成一个VNF，同时将其放在底层网络上。如果无法嵌入VNF，则算法将返回上一个成功步骤并尝试执行备用映射。

* **<span class="tooltip" titles="VNF-FG Placement">VNF-P</span>**

根据给定的目标，将VNF放在合适的节点上。每个VNF都定义为包括计算，存储或网络的类型; 因此，必须将其分配到具有相同类型的物理节点中。实际上，VNF管理器和VIM的协调器会评估所有条件，然后将VNF分配给物理资源。大多数现有方法都集中在VNF-P阶段。

  >1. 巴里等人将VNF-P考虑为一个整数线性规划（ILP）问题，并在CPLEX中实施，以最大限度地降低运营支出（OPEX）。他们还提出了一种动态编程算法来解决规模更大的问题。实验表明，这种方法可以显着降低网络的运营成本。
  2. Elias等人通过考虑网络拥塞，将VNF-P问题表示为非线性整数模型。此外，他们提出了分布式动态定价策略，从而产生接近最优的解决方案。数值结果表明，该方法减少了资源拥塞。


* **<span class="tooltip" titles="VNF Scheduling">VNF-S</span>**

调度技术允许VNF共享资源，以便最小化网络服务的总执行时间。目前研究较少。

  >1. Riera等人使用灵活的作业车间问题表述VNF调度问题，其目标是最小化上次执行的服务的最后一个VNF的最终执行时间。实际上，它们提供了一组在光学基板上调度的VNF的形式描述。
  2. Mijumbi等人提出了三种贪婪算法和一种用于在线放置和调度网络功能的禁忌搜索方法，目的是最小化服务执行时间。仿真结果表明，Tabu搜索方法在映射速率、服务处理时间、收入和成本等指标上的表现仅比贪婪算法略好一些。
  3. Myopia是一种新型公平调度算法。优点是低复杂度、高效率、精确地调度大象流；但以先进先出（FIFO）方式处理小鼠流。

## 现有方法

#### 应用场景
.
* **动态与静态**

许多作者认为环境是静态的，而在当今的现代网络中，由于移动设备的使用不断增长，用户需求和网络条件是高度动态的。结果，VNF的动态资源分配是一个非常重要的问题。在动态环境中，必须在运行时分配资源，这是一个更复杂的问题。这带来了新的挑战，因为VNF资源可能由于动态流量而扩展，并且QoS需求可能由于服务请求的变化而改变。此外，我们应该监视VNF的可靠性问题，当VNF发生故障时，我们需要为相应的服务请求重新分配VNF。

  >1. Wang等人研究了动态功能组合的问题，并通过将动态功能组合问题定义为MMKP（多维多选0-1背包问题）来开发组合模型。他们使用马尔可夫近似方法来解决问题。
  2. Callegati等人建议使用Open-Flow来动态控制交通流量。他们描述了必须在Open-Flow交换机中编程所需的操作，以实现动态服务链。
  3. 该被建模为马尔可夫决策过程（MDP），并提出了先发制人的资源分配策略。 此外，作者建议使用贝叶斯学习算法来预测未来的资源可靠性，并提出了考虑异步分区的基于MDP的算法。

* **在线与离线**

在离线场景中，给定一组服务，我们将它们嵌入到网络中。在线方案中，服务请求逐个到达，每个服务一到达就嵌入到网络中。在这种情况下，可能需要迁移和重新映射已嵌入的VNF。

  >1. Mohammadkhan等人通过最小化资源消耗来制定VNF-FG放置问题以实现最小延迟。然后，他们提出了一种启发式算法，可以在不影响现有流量的情况下逐步解决到达流量的问题。
  2. Lukoszki等人考虑服务链嵌入问题（OSCEP）的在线版本，其中请求随时间推移到达。他们提出了一种确定性在线算法，该算法在确定性和随机情况下都是渐近最优的。

* **单个与多个提供商**

在提供网络服务时，有时需要实现跨越多个服务提供商的基础设施的服务链。 但是，在多种提供商场景中，信息交换的限制和不同提供商之间互操作性的问题意味着一些新的挑战。

>1. Abujoda和Papadimitriou提出了协调处理设置的框架，称为MIDAS（中间盒发现和选择）。MIDAS在每个提供商中使用集中式中间盒控制器。首先，MIDAS使用信令协议来发现合并的中间盒；然后，在这些中间框之间建立链。接下来，MIDAS在每个提供商中选择合并的中间框，并通过其控制器的协作分配提供商。最后，控制器指示分配的合并中间框安装和配置所需的处理模块。
2. 迪特里希等人建议使用拓扑抽象来隐藏提供商的机密信息。 此外，作者还提出了Nestor作为嵌入服务请求的系统，包括图形渲染，请求分区和NF子图映射三个主要阶段。

#### 参数考虑

* **资源属性**

属性不同，考虑的方法不同。虚拟功能具有不同类型和不同属性。根据物理节点能够托管的VNF的类型，它们的属性可能不同。链路属性也不同，例如带宽或传播延迟。

* **目标**

在解决SFC问题时，必须优化一个或多个战略目标。不同的网络服务需要不同的目标。例如，在实时网络服务中，需要低延迟。对服务提供商而言重要的主要目标是最大化接受率，增加收入，最大限度地减少消耗资源和降低成本。在文献中，延迟，可靠性，负载平衡和节能等目标也很常见。

* **评估指标和工具**

评估指标对于衡量解决方案的质量是必要的。可以根据使用的目标函数使用不同的评估度量。用于评估SFC解决方案的一些性能评估指标是服务处理时间，收入，成本，活动物理节点数，接受率，资源利用率和流量拥塞。对于模拟工具，文献中常用的有MATLAB，CVX，CPLEX，MININET，NS2等。

#### 解决方案策略

* **优化模型**

可以将SFC问题建模为优化问题。比如整数线性规划（ILP），混合整数线性规划（MILP），整数规划（IP），混合整数规划（MIP）等。虽然ILP在许多情况下是NP-complete问题，但是有一些精确的算法可以在合理的时间内解决问题的小实例。 

* **解决方案技术**

由于SFC是一个优化问题，它可以通过使用精确，近似，启发式或元启发式解决方案技术来解决。

* **单阶段与多阶段**

如前所述，SFC的问题由四个阶段组成。许多现有方法将注意力集中在仅解决一个问题阶段。 但是，在某些工作中，同时考虑问题的不止一个阶段。这些方法可以以不协调或协调的方式起作用。

## FUTURE DIRECTIONS

* 动态在线链接

在现实世界中，服务请求在未知时间动态地到达网络并且持续时间未知。
因此，链接算法必须在服务请求到达时在线解决问题。 另一方面，静态链接方法不考虑重新组合，重新映射和重新调度一些先前组成的，映射的和调度的服务请求的可能性。
然而，在动态环境中，服务请求可能随时间而改变，因为可以添加新的VNF或者可以从服务请求中删除一些VNF，这意味着在这些流行的环境中可能需要重新组合，重新映射和重新安排。

* 多阶段方法

SFC问题的不同阶段是相互关联的; 将所有阶段一起考虑并协调执行它们以优化网络性能很重要。

* QoS和SLA感知方法

部署网络服务时，必需保证SLA中约定的QoS参数。大多数现有提议通过考虑物理节点的计算和存储器资源来保证VNF的带宽要求和端到端延迟要求。但是，一些QoS参数如抖动和数据包传输率尚未被广泛考虑。
还有虚拟化动态多云环境中的QoS和SLA也有一些实施工作，但是要适应SFC，必须做出修改。
另外，为了提供QoS，NFV协调器必须实时监控网络功能性能。

* 弹性和可用性

通过使用自动机制在故障后重新组合，重新映射和重新安排失败的服务链，可以实现对故障的恢复。
此过程不应对其他链产生影响，以确保服务连续性。在NFV和SFC中提供弹性时，负载平衡器可以与SFF一起定位，以提供路径故障的鲁棒性。
保护网络服务免于故障的简单方法是使用传统冗余机制，例如虚拟路由器冗余协议（VRRP）。

* 能源效率

设计最佳服务功能链方案时必须考虑能量因素。节点的能量产生/消耗速率必须被视为设计用于服务功能的最佳链接，放置和调度的算法的主要度量。

* 安全

与其他软件定义的体系结构类似，新提出的NFV和SFC体系结构也容易受到安全攻击。通过攻击虚拟化功能，整个服务链可能会失败。虽然已有许多解决方案可以保护软件组件免受攻击，但必须重新考虑这些解决方案以适用于NFV和SFC场景。

* 分布式方法

NFV和SFC领域中提出的大多数方法都是集中式的，其中单个节点负责运行算法。集中式方法有一些严重的缺点，限制了它们在实践中的适用性。他们的可靠性差，单点故障问题。另一方面，有时尤其是在多服务提供商的情况下，使用集中式算法是不可行的。
ETSI有一个关于分布式NFV的提议，该命名为多供应商分布式NFV。此外，Nestor，MIDAS和DistNSE是不同的分布式在同构场景中为SFC提出的方法，其中不同的提供商具有相同的网络功能。罗莎等人考虑异构场景，其中服务功能链跨越几个不同的提供者。

* 无线和移动网络

无线/移动和有线/固定网络之间存在许多差异。无线网络具有一些新类型的硬件资源，并且存在一些新的约束，例如衰落和干扰。另一方面，用户移动性是移动网络的主要特点。移动网络通常具有比固定网络更多的各种服务功能。在设计无线和移动网络的服务链时必须考虑这些差异。

