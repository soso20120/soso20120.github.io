---
layout: post
title: Blockchain-Based Proof of Delivery of Physical Assets With Single and Multiple Transporters 
tags:
- Blockchain
- Supply Chain

---

## Abstract

随着电子商务的普及，需要一个可信赖的系统来确保交易物品的交付至关重要。目前的交付证明（PoD）系统缺乏透明度，可追溯性和可信度。这些系统主要集中在一起，依靠可信赖的第三方（TTP）来完成卖家和买家之间的交付。 TTP可能成本高昂，单点故障，并且受到黑客攻击，隐私逃避和妥协。区块链是一个不可变，可信和分散的分类帐，其中包含可用于透明度，可追溯性和跟踪的日志和事件。在本文中，我们使用流行的无权限以太坊区块链提供解决方案和一般框架，以创建一个可信的，分散的PoD系统，确保**问责制，可审计性和完整性**。该解决方案**使用以太坊智能合约来证明卖方和买方之间交付货物的交付，而不管所需的中间转运商的数量**。在我们提出的解决方案中，所有参与实体都被激励通过使用双重存款抵押品(double deposit collateral)来诚实行事。以太网中的自动付款是解决方案中不可或缺的一部分，以确保每个实体在成功交付后获得其预期的以太份额。如果在运输过程中出现争议，也会纳入仲裁机制。在本文中，我们将展示如何实施，验证和测试PoD解决方案的正确功能。我们还提供安全分析并估算以太气体的成本消耗。我们在Github上公布了以太坊智能合约的完整代码。

## INTRODUCTION

如今，网上购物已成为大多数人购物和购物的最便捷方式。在线购物为消费者提供了极大地节省时间，比较价格，检查评论，类似产品或当前趋势的能力。随着时间的推移，电子商务购物越来越受到青睐，尤其是随着智能手机的普及以及互联网的易用性[1]。根据UPS的数据，智能手机在线购买者的比例已经上升至77％，而2015年为55％[2]。因此，为了满足需求的增长，供应商现在提供递送服务以增强购物者的能力并提升他们的体验。因此，非常需要交付交易的实物和产品的证据，以便以可信，透明和具有成本效益的方式促进装运，特别是如果卖方，买方和运输商位于不同国家的全球和不可信任。交货凭证确保已装运的物品已到达其授权目的地，并能够在卖方，中间运输商和买方移动时向装运状态的所有相关方提供证据。

目前的交付证明（PoD）系统缺乏透明度，可追溯性和可信度。例如，大量的PoD服务依赖于签名的文件和文件作为认证方式，用于证明向接收者的交付。这些纸通常与运输车一起携带。然而，还有其他PoD系统依赖于手持电子设备进行认证过程。因此，接收者将提供电子签名和有效的身份证（ID）。然后，它将取决于运输商验证提供的文件和签名，并确保将该项目提供给正确的预期收件人。这种方法依赖于运输者和接收者的诚实，因为ID可以伪造。另一方面，在线零售商可能并不总是拥有自己的运输服务。有些公司会依靠受信任的第三方来管理交付。例如，亚马逊依靠不同的快递服务来提供国家和地区的送货服务。FedEx，UPS和DHL是亚马逊依赖其区域出货的一些公司[3]。

此外，当前系统大多是集中式的，依靠可信赖的第三方（TTP）来完成卖方和买方之间的交付。这些系统难以管理，并且由于涉及TTP而成本高昂。不仅如此，TTP可能是单点故障，并且受到黑客攻击，隐私逃避和妥协的影响。因此，使它们不可靠，不值得信赖[4]。因此，迫切需要一种分散式解决方案，该解决方案在不依赖第三方的情况下以安全可靠的方法提供物理项目的PoD以及可追溯性。

Blockchain是一个不可变的，防篡改的，分散的分布式分类账[5]，[6]，具有丰富的安全功能[7]，可以创建所需的PoD解决方案。区块链使用有序日志和事件来实现可追溯性和可审计性。此外，使用以太坊使区块链可编程。以太坊智能合约通过允许执行代码来赋予区块链[8]。

交易实物资产，物品，产品或货物的合理PoD解决方案必须满足以下关键要求[4]。**问责制**，即将某些操作归因于特定参与者的能力。问责制类似于不可否认性，其中参与者不能拒绝承诺的交易。**惩罚和激励**，确保参与实体有诚实行事的动机;否则，将受到处罚。**可审计性**，系统以完全安全和可信的方式提供跟踪和跟踪事件和操作的机制。**完整性**，所有交易，日志和事件都带有时间戳和防篡改功能。**身份验证和授权**，确保某些功能和操作只能由特定的参与者执行。**Timebound**，确保项目在特定时间范围内到达其最终目的地。此外，另一个重要的要求是**脱链仲裁**，允许判决实体在任何行为人提出虚假声明的情况下解决任何争议。所选择的仲裁员对已组装的资金拥有完全的访问控制权，仲裁员在检查分类账上的证据后可以将其分散。

关于有形资产的PoD的初步简短会议论文已经发表[4]。与此形成鲜明对比的是，这篇文章在很多实质性和重要方面都有所不同。首先，在这项工作中，所提出的PoD解决方案适用于单个和多个转运器，它们对多个转运器非常重要，如[4]所述，该解决方案被设计为仅适合卖方和买方之间的单个转运器。其次，[4]中的实现使用两个密钥，这对于多个传输器来说是麻烦的。因此，在本文中，优化实现以更好地利用区块链的安全功能，并仅使用一个密钥进行验证。此外，这是主要和重要的差异之一，[4]中的解决方案只使用一个简单的合同。与此形成鲜明对比的是，本文提出的解决方案是由三种不同类型的合同制成的。这些合同相互关联，就像链条一样，可以说明任何数量的中间转运商。在本文中，我们还强调了燃气消耗以及以美元计算的成本。此外，本文还对提出的解决方案进行了全面的安全性分析。

在本文中，我们提出了一个基于区块链的解决方案和一般框架，用于证明涉及单个和多个运输商的物理项目的交付。我们的解决方案专注于解决当前集中式系统所遭受的问题，例如使用TTP引起的集中化。因此，我们的解决方案是分布式的，消除了信任问题和对TTP的需求，并提供了跟踪日志的能力，而无需受信任的第三方，并利用链式仲裁来处理争议。本文的主要贡献可归纳如下：
* 我们提出卖方和买方之间的PoD系统和框架，而不管运输商的数量。
* 我们使用以太币代币自动付款，并采用激励和惩罚措施，迫使参与者诚实行事。
* 我们利用InterPlanetary文件系统（IPFS）来确保商定的条款和条件的完整性，并将IPFS哈希链接到以太坊智能合约。
* 我们处理取消以及延迟退款的退款。我们还采用了一种脱链仲裁机制，让选定的仲裁员控制资金以解决纠纷。
* 我们将讨论并详细说明与实现算法，测试和验证相关的关键方面。
* 我们根据以太气体提供解决方案的成本分析，并讨论解决方案如何满足关键安全目标以及它如何抵御常见的网络安全攻击。

本文的其余部分安排如下。第二节介绍了相关工作。第三节详细介绍了拟议的区块链以太坊解决方案实施。第IV部分提供了测试细节以及有关安全性和成本分析的讨论。第五节总结了论文，并讨论了未来的工作。

## Related Work

在本节中，我们将回顾和总结与使用区块链的交付算法和技术相关的工作。我们还调查了分散的基于区块链的市场。

[9]中的作者提出了一个基于以太坊区块链的简单方案，该方案涉及在两方之间运输产品。该计划取决于卖方给予运输商的单个密钥[9]。钥匙随物品一起运输，并交给作为买主的接收人。然后买方需要输入密钥进行验证。密钥哈希已经在智能合约中可用，该合约充当托管并持有买方的以太网。如果买方输入的密钥的哈希值与智能合约中的现有哈希值匹配，则以太币将仅被放置在卖方的账户中。成功的验证会导致以太币转移给卖方[9]。该解决方案易于实现，因为它很简单并且仅依赖于一个密钥。然而，该方法取决于完全信任运输装置，在到达买方之前不会对钥匙进行操作。它也缺乏鼓励所有参与方保持诚实的动机，尽管这种做法因任何参与实体（尤其是运输商）的恶意行为而失败。

利用区块链技术创建在线分散的点对点市场以进行以太交易的解决方案称为“localEthereum”[10]。 LocalEthereum不依赖合同作为托管[10]。该技术依赖于受信任的第三方，该第三方是卖方和买方商定的资金托管。这种方法需要信任第三方，因为它需要支付托管费用。此外，卖方将以太币与资金托管放置，买方直接向卖方提供付款。如果卖方确认付款，则交易完成，卖方将解除托管。但是，如果发生争议，则设立仲裁员（localEthereum）以解决争议。显然，这种解决方案成本高昂，因为它依赖于TTP作为托管，也不会给买方和卖方在任何争议情况下选择其可信仲裁员的能力。它也没有显示激励参与实体的方式，并且运输商不参与任何链日志。

与localEthereum类似的概念是“OpenBazaar”，它依赖于买方和卖方或交易商商定的资金托管，这被称为“多重签名托管”[11]。在有争议的情况下，受资助的托管也将担任主持人（moderator）。因此，销售物品的过程涉及三方。卖方，买方和主持人。买方会将比特币（OpenBazaar中最常用的货币）放入资金托管中。付款将仅根据参与者的主要选票发布到商定的目的地。超过三分之二的选票将决定付款转移的目的地[11]。该方法不涉及转运过程中的任何转运者。运输商完全信任，没有任何动机从卖方取出物品并将其交付给链条外的买主。因此，链条上没有跟踪运输装置。

“SOMA”是另一个分散的市场，它利用社交平台促进贸易[12]。 SOMA使用区块链为分散的市场添加社交方面，该市场的灵感来自Facebook上创建的交易团体。 SOMA为用户提供了推广其项目的能力。每个物理项目都使用交互式项目卡（IIC）拥有数字表示。当所有者决定出售时，所有者选择推广其物品的IIC。所有者还可以允许其他SOMA用户宣传该项目。 IIC具有该项目的所有历史记录，包括所有权历史，真实性及其社会价值。如果该项目成功售出，则促销员将获得SOMA社区代币（SCT）的奖励。该奖励与“奖金合同”一起保留，如果该项目未被出售，则将在赔偿后返还给所有者。该奖励系统为平台用户彼此协作创造了激励。 SOMA使用Solidity编写智能合约，并使用服务器存储项目的信息。只有数据签名，密钥和数据库链接存储在区块链中。然而，一个主要缺点是运输是在链条外完成的，而不是奖励系统的一部分[12]。因此，使用区块链日志无法进行跟踪和跟踪。

“Syscoin Blockmarket”雇佣区块链为商品交易提供另一个分散的市场，包括小型数字文件[13]。卖方和买方同意受信任的第三方仲裁员担任托管。仲裁员收取他们的捐款费用。每个平台用户都有声誉，可以激励每个人诚实行事。此外，系统启用通知以使用户了解有关装运状态的更新。此外，通过允许卖方拍摄已发送包裹的视频并对其进行散列来完成装运证明。哈希包含在事务详细信息中。这有助于更快地解决争议。该系统还鼓励对以太坊地址使用别名。最后，该系统允许通过使用数字证书来交易小型数字文档[13]。尽管该系统激励卖方，买方和仲裁员通过基于声誉的解决方案行事诚实，但系统忽略了运输商以及将其包含在链条中以提高透明度和可追溯性的重要性。此外，仲裁员充当托管人，即使没有争议，也始终可以持有资金。因此，如果仲裁员决定不诚实，这种解决方案可能是单点故障。

“BitBay”是另一个分散的市场，允许交易以及买卖[14]。 BitBay使用区块链创建一个分散的市场，并依靠智能合约实施“双重存款托管”，以激励所有各方诚实行事。这要求买方和卖方将物品价格两次存入合同。如果出现任何问题，每个人都会丢失存放的抵押品。没有仲裁员来核实和解决纠纷[14]。此外，运输商不包括在运输过程中的关键参与者。

所有这些现有的区块链分散方法都有明显的局限性，需要改进才能拥有一个包含PoD解决方案的更高效，更完整的系统。首先，在[9]-[10] [11]中，任何参与实体都没有动机诚实行事。卖家，买家和运输商都完全信任。其次，[10]，[11]和[13]依赖于受信任的TTP或仲裁员作为托管，并从销售过程开始直到结束时持有所有资金。拥有资金的TTP可能是单一的集中故障点，而且成本也很高。此外，[9]，[12]和[14]没有解决争议的机制。因此，对于任何不诚实行为，卖方，买方或两者都会失败。此外，除了第一个解决方案[9]之外的所有上述解决方案都是分散的市场，不提供分散的PoD解决方案。参考文献[10] - [11] [12] [13] [14]使运输车脱离链条，不要让运输商参与链条上发生的任何激励或日志。因此，这使得跟踪和跟踪更加复杂，并且不利用区块链来证明货物的交付。在我们的解决方案中，我们创建了一个分散的PoD解决方案，不仅涉及在争议情况下的仲裁，并且激励所有参与方在不使用TTP的情况下诚实行事，而且还涉及单个和多个运输商在链条上进行缓解跟踪和跟踪以及解决争议。

## Proposed Blockchain Solution

在本节中，我们将介绍我们的以太坊区块链解决方案，该解决方案利用该技术的安全功能，为涉及单个或多个运输商的卖方和买方之间的PoD创建解决方案。 卖方和买方可能距离几英里或在不同国家。 我们的解决方案可以根据需要扩展到尽可能多的运输商（或快递服务），并以足够，可靠和安全的方式工作，类似于仅使用一个运输车。 我们的解决方案通过确保每个参与实体存放抵押品来激励所有各方诚实行事。 此外，与其他解决方案不同，转运系统是链上系统的一部分，并在所提出的PoD解决方案中发挥作用。 这增加了信任和安全性，有助于准确解决争议。

#### System Overview

拟议的区块链解决方案侧重于双方交易实物资产的交付证明。图1显示了系统的主要参与实体，卖方，买方，快递服务，仲裁员和智能合同认证机构（SCAA）。每个实体都有一个以太坊地址，并根据权限与整个流程中创建的智能合约进行交互。当项目在两个实体之间交付时，根据快递服务的数量创建一系列合同。但是，卖方和买方之间至少需要两份合同。此外，卖方，买方和快递服务之间协议的条款和条件应在开始交易之前签署并达成一致。因此，条款和条件协议的InterPlanetary文件系统（IPFS）哈希是创建的合同的一部分。如果所有实体都同意，则交易开始，并且从主要实体即卖方，买方和运输方撤回商定的抵押品。参与者的角色可归纳如下：
* 卖方：卖方将要包装的物品转移给感兴趣的买方。卖方在链条中创建第一个合同。因此，卖方是创建的第一份合同的所有者。
* 买方：买方希望花费以太币并从卖方处购买该商品。
* 快递服务：根据卖方和买方的地理位置，如果需要，可以使用多个快递公司将商品从卖方交付给买方。运输商在链中创建下一个合同。
* 仲裁员：仲裁员是卖方，快递服务和买方的可信实体。其主要任务是确保在发生争议时保留每个参与实体的权利。在正常交易期间，区块链解决方案完全独立于仲裁者。仲裁员的参与很少，并且不参与正常行为下的每笔交易。此外，仲裁员无法撤销，更改或伪造买方卖方或运输商的订单和行为。**只有在交易失败时，存入合同的任何以太币才会转移给仲裁员，然后根据离线仲裁的结果重新分配。**
* 智能合同认证机构Smart Contract Attestation Authority（SCAA）：SCAA证明链中的每个合同，以确保代码满足商定的条款和条件。如果合同由SCAA证明，合同地址将成为SCAAs合同的一部分，SCAA地址将包含在合同中。因此，经证实的合同和SCAAs合同相互指向。

区块链技术的一个好处是透明度和记录公共分类账上所有内容的能力。因此，链中使用的以太坊智能合约利用此属性创建事件和日志，以帮助在项目打包，交付和从一个实体传递到另一个实体时跟踪项目。此外，key hash用于确认运输商和买方接收物品。因此，密钥是物理地给予下一个快递或最终给买方，然后创建其散列并与智能合约中已有的散列进行比较。进行此验证是为了确保该项目已被某个实体真正接收。为了通过透明度实现所需的功能并在项目合同链中跟踪项目时，智能合约包含以下内容：
* Methods：在智能合约中使用方法来创建函数调用。每个函数负责执行和实现所需的操作。因此，在这项工作中，我们创建的一些重要职能包括存放抵押品的方法，在任何双方之间进行密钥验证以及结算付款和处理争议。所有公共变量都具有为其创建的自动getter函数。但是，必须根据需要创建setter。因此，要更改合同的状态，会创建一个setter函数，以仅允许其父级或其自己的子级更改其状态。
* Modifiers：在智能合约中使用修饰符在执行函数之前创建需求。例如，抵押品应该是一定的约定金额。使用modifier检查。其他modifier也根据函数调用者的以太坊地址用于限制函数的执行。因此，某些功能只能由卖方执行，其他功能分别由运输商和买方执行。
* Events：事件充当通知并用作日志，有助于在发生争议时进行追溯。因此，执行的任何函数都会创建一个事件，该事件将更新有关项目状态和合同的所有实体，直到现在。
* Variables：变量用于存储可能随事务进展或某些检查和功能所需的信息而变化的信息。因此，合同中的主要变量用于存储参与实体的以太坊地址，密钥验证比较中使用的密钥哈希，项目价格，合同状态，IPFS哈希以及每个子契约的地址。链中的母公司合同。

#### System Design

为了在卖方和买方之间交付物品并创建适应所需快递服务数量的解决方案，设计了三种类型的合同。合同是根据需要创建的，并且他们还签订了一系列合同。每份合同都指向下一份合同。因此，每个父母合同都有其子合同的地址，每个子女都有其父合同的地址。此外，所有合同都具有启动该链的第一个主合同的地址。主合同还有一个附加地址，这是该链中最后一份合同的地址。

该chain至少应有两份合约。因此，这表明如果只需要一个运输车，则将创建两个合同。但是，如果需要多个运输商，则至少创建3个合同。它也始终以交货证明（PoD）类型的合同开始，并以买方转运（BT）类型的合同结束。因此，PoD是主要合约，BT是连锁合约的终结。在中间，如果传输器的数量大于1，则根据需要创建类型Courier服务（CS）的合同。

图2显示了仅有一个运输商的合同链。因此，该链仅由两个合约组成，即PoD主合约和BT合约链。图2还说明了与每个合同交互的实体。卖方仅与PoD合约进行交互，而运输方和买方是合同的一部分。此外，它们都将其抵押品存入PoD合约。

另一方面，图3显示了三个转运链。 因此，PoD和BT合约之间还有另外两种类型的Courier服务合约。 所需的快递服务合同数量始终比运输商数量少1。

图3还显示了参与链中每个合同的实体。在PoD合同中，卖方，买方和第一运输商签署条款和条件并存放商定的抵押品。之后，卖方会创建包裹并将其与钥匙一起交给运输商。然后，运输商将创建下一个CS合约，运输公司2同意条款和条件，并存入由CS合同持有的抵押品。因此，每份合同都作为托管给它的以太币托管。然后，运输公司2将收到包装物品，并通知每个人已经运输工具1到达。这是一个重要的步骤，允许Transporter 1确认它已到达，并且密钥现在与Transporter 2一起使用。然后，Transporter 2输入经过哈希处理的密钥，并与合同中已有的密钥哈希进行比较。如果验证成功，则下一个CS合同由Transporter 2创建，并且链接继续，直到目标地址是买方的地址。当目的地与买方地址相同时，创建BT合同，并完成最终密钥验证。

## Implementation Details

使用Remix IDE创建和测试合同，Remix IDE提供了测试和调试所需的工具。因此，在编程时可以根据需要更轻松地修改代码。本节重点介绍智能合约中使用的实现算法。

用于编写智能合约的语言是Solidity。如设计部分所述，创建了三种类型的合同，即PoD主合同，CS合同取决于运输商的数量和BT合同的终端。实施中的一个基本要素是，整个链中的每个合同都包含父合同和子合同的合同地址。这允许在自动付款结算和争议处理期间将资金转移到目标方。

此外，每当物品在链中移交时，接收者将首先确认运输者的到达，然后允许运输者确认到达并提供验证密钥。这种“握手”具有重要意义，因为它有助于使双方彼此需要，从而诚实行事。图4显示了一个流程图，该流程图显示了使用代码创建的合同链背后的完整逻辑.1该流程图显示了完整的流程周期，从PoD主合同开始到BT链终止合同结束。本节的其余部分讨论了代码中使用的重要算法的细节。

#### Signing Terms and Conditions

算法1显示了签名条款和条件的算法。 对于创建的每个合同，未签署条款和条件的新参与者应在新创建的合同中执行此操作。 因此，例如在第一份合同中，所有参与者，即卖方，买方和运输方1将签署条款和条件。 在下一个CS合同中，只有Transporter 2会这样做，依此类推。 在最后的BT合同中，没有签署任何条款和条件。

需要注意的是，每个需要签名的合同中都有IPFS哈希值。 参与者需要访问链条下的条款和条件，如果他们同意其条款，请在链条上签名。 通过签署条款和条件，商定的抵押品将从签字实体中扣除。 条款和条件协议表包含有关物品详细信息，价格，抵押品和卖方与买方之间运输过程的所有必要信息。

#### Cancelation and Refund(取消和退款)

只有在特定条件下，卖方，买方和/或运输商才能取消交易。算法2显示了从主PoD合约发生的取消算法的细节。算法所需的输入包括呼叫者的地址和取消状态。 cancelationstate是一个布尔值，最初初始化为true，只有在物品交给运输商或正在前往下一个目的地的途中才会变为假。任何提到的实体都可以决定取消交易。例如，如果物品尚未移交给运输商，则卖方和运输方可以取消交易。但是，只要商品没有到达下一个目的地，买家就有机会取消。如果物品正在交付，则没有人可以取消交易。因此，取消只能从第一份合同中调用，如果取消交易，则会退还已存放的抵押品。

#### Key Verification

每次将项目移交给其他参与者时，都会进行密钥验证。 接收实体首先确认交付运输商到达，这将创建通知并将合同状态更改为“确认完成”。 这种状态变化是交付运输者能够将物品和钥匙交给接收者的要求。 一旦密钥被移交，合同状态将变为“到达目的地”。 因此，接收实体，然后买方或另一个运输商将输入生成keccak256散列的密钥，并与合同中的现有散列进行比较。 算法3显示了密钥验证功能如何在代码中工作的完整细节。 算法的输入包括授权调用者，该调用者应该是买方或下一个传输器的地址，以及keyhash，它是存储在合同中的密钥的正确散列。

#### Exceeding Delivery Time

在处理送货服务时，准时是至关重要的。 因此，由于交货时间有助于给客户留下良好的印象并提供良好的客户服务，如果交货超过预期的交货时间，买方有权拒绝接收物品。 算法4显示了超时交付时间算法的细节，该算法只能从BT合约的BT端进行。 只允许买方调用该功能，只有在超过预期的交货时间时才会执行该功能。

#### Payment Settlement

当所有关键验证在整个链中成功时，该项目由最后一个运输商到达买方。 在BT合同中，买方确认运输商的到达并交给物品和钥匙。 买方执行最后一次密钥验证。 如果密钥验证成功，则只有这样才能结算付款。 这个成功的密钥验证自动生成对PoD主合同的调用，该主合同将在链中的每个合同中传播结算支付功能，如图5所示。

因此，链中的每个合同都支付每个运输商的存款（物品价格的两倍）以及运输费，然后将合同中持有的以太币转移到子协议。最后，最后的BT合同向买方偿还抵押品，余额返还给卖方。在执行结算支付功能之前，每个合同的状态也会发生变化。

此外，为了使子女合同从另一份合同中获得以太币，CS和BT合同中可以使用退款应付职能（ fall back payable function）。后能是没有名称的功能，其主要功能是允许合同接收以太网。他们还有一个事件来创建有关收到的付款的日志。重要的是要注意，一旦创建，必须在PoD主合同中更新BT端链合同的地址。这需要将PoD结算支付功能的访问限制在BT合同的地址。因此，尝试执行结算支付功能的任何其他地址都将导致错误和恢复状态。算法5显示了支付结算的完整细节。在算法中，授权调用者用于限制仅访问BT合同或父合同。此外，输入调用者是创建事务的以太坊地址。父母合同是指调用合同的父母的地址，主合同是PoD合同。

#### Dispute Handling

在链条中的任何一点都可能发生争议，该项目已被移交给另一个实体并且即将进行密钥验证。如果输入的密钥的计算的keccak256散列与合同中已有的密钥散列不匹配，则密钥验证的结果可能导致争议。因此，任何两个运输商之间或运输商和买方之间都可能发生争议。此外，如果由于密钥验证失败而发生争议，则很难确切知道它的错误。结果，存在于链中的所有醚应转移到仲裁器。然后，仲裁员将对链接检查日志和情况，并相应地分配以太网。

图6显示了在BT合同中链末端存在争议时的函数调用流程。在BT合同中，如果物品超过交货时间，并且买方在知道物品正在运行时拒绝接收物品，也可能发生争议。超出交货时间的原因无法在链上确定。因此，遵循争议程序，算法6，然后仲裁员将解决链外的问题。图6显示了通过链条处理争议时的顺序调用。可以看出，呼叫向后传播直到达到主PoD合同。在每份合同中，州将更改为争议，然后该合同所持有的以太币将转移给仲裁员。算法6详细说明了算法。算法的输入包括授权调用者，在这种情况下是授权调用者，或儿童契约或下一个运输者。

## Testing and Validation

本节介绍测试智能合约代码的详细信息。 此外，它还讨论了代码的气体成本分析及其安全性分析。 测试了两个主要功能，即BT合同中的争议处理和成功验证后的付款结算。 在BT链终端合同中成功验证表明整个链中的密钥验证成功。 此外，测试是针对一个转运商和多个转运商进行的。

#### Child Contract Address Addition

所有父母合同都有其子女合同的地址。 PoD主合同拥有子合同地址，就像整个链中的所有其他合同和链地址的BT端一样。 图7显示了成功添加到PoD合同的子合同地址。 在创建子契约后执行此步骤。 运输商在父合同中设置子合同地址，在这种情况下，PoD合同和在日志中创建包裹正在途中的事件。

#### Buyer-Transporter Handshake

买方必须宣布运输车已经到达，因此运输商可以确认到货并交出物品和钥匙。 此握手已成功测试。 图8显示了买方执行的函数“confirmTransporterArrival”的成功执行。 这改变了合同的状态，运输商只能在买方这样做之后确认到货。 图9显示了运输车确认到货后的日志。 日志表明该密钥现在与买方进行验证。

#### Successful Key Verification

成功的密钥验证可以实现付款结算。 图10中的日志显示了在仅有一个传输器的两个合同链中成功进行密钥验证后的事件。 可以看出，成功的密钥验证，自动调用BT合约中的结算支付功能，该功能调用PoD合约的功能。 然后，运输商从PoD合同中支付，然后将余额转移到BT合同中，在那里买方和卖方将获得存款和付款。

此外，在三个运输商链中进行成功的密钥验证，因此，一个PoD合同，一个BT合同和两个CS合同导致付款结算，如图11所示。每个参与者在他们的账户中有100个以太网。 最后三个运输商收到0.2以太作为运输费及其抵押品。 因此最终得到了近102以太。 买方收到了抵押品，并为该物品支付了2个以太币，因此买方在最后的帐户中有近98个以太币。 最后，卖方收到的余额几乎为1.4以太。 因此，由于增加了来自买方的2个以太并向运输商支付0.6以太，最终卖方几乎有101.4以太。

#### Unsuccessful Key Verification

在移交项目之后，接收者输入密钥，该密钥被散列并与合同中已有的散列进行比较。 散列不匹配会导致验证失败，导致争议。 为了处理争议，所有以太人都被转移到仲裁员。 流体向后传播通过链条。 在图12中，可以看到在BT合同终端中发生的处理争议的部分日志。 这些事件表明关键哈希值不匹配以及资金转移给仲裁员。

在多个转运商的情况下也适用相同的程序。 图13显示了处理争议后发生的变化。 在这种情况下，有两个运输车，物品价格是2以太。 因此，除了仲裁员之外，所有参与者的余额几乎都是96以太。 这是因为扣除的抵押品是商品价格的两倍。 当争议发生时，最初有100以太的仲裁员像所有其他参与者一样从所有合同中获得资金，最终得到了近116个以太。

#### Cost Analysis

在以太坊区块链中使用气体作为交易所需计算工作的度量。不同的交易需要不同数量的天然气，交易费用以天然气计算，但实际成本以以太币支付。因此，“天然气成本”是交易所需的天然气量，“天然气价格”是以太天然气的单价。此外，如果代码中存在任何错误，则为每个事务设置限制以避免耗尽气体。因此，气体限制提供了安全机制。根据每单位气体“Gwei”消耗的乙醚量，也可以加快交易速度。 Gwei的数量越高，优先级越高，因此优先级和成本之间存在折衷。矿工将更加激励执行提供更高天然气价格的交易。选择合适的天然气价格有点困难，因为它需要持续监控网络。然而，ETH加油站通过在其网站上提供三种不同的类别使这更容易[15]。
* SafeLow：这是一种天然气价格，可以选择用于廉价和安全的替代品。它是负担得起的，同时交易将被迅速开采。此价格是在过去24小时内以此价格执行至少50笔交易后确定的。
* 平均值：这个汽油价格被顶级矿工接受，通常非常接近默认钱包价格。
* 快速：这个价格是所有顶级矿工所青睐的最低价格。选择高于此价格的价格很可能不会达到更好的速度。

在使用的成本分析中，使用了4 Gwei的天然气价格，这是目前基于ETH加油站的平均价格[15]。 较高的汽油价格意味着交易成本也较高。 表1显示了Gwei在BT链终端合同中执行成功密钥验证的天然气成本，该成本产生了付款结算。 比较不同数量的运输商的天然气成本。 随着运输商数量的增加，天然气成本增加。 无论运输商的数量如何，任何一家连锁店都有一份PoD合同和一份BT合同。 然而，不同的并且造成成本差异的是CS合同的数量，它总是比运输商的数量少一个。 因此，一个运输商意味着该链只有两个合约而没有CS合约。 此外，两个和三个运输商分别产生一个和两个CS合同。 因此，天然气消费量增加。

另一方面，表2显示了在BT合同结束时密钥验证失败的气体成本，这导致争议和资金转移给仲裁员。 就像成功的密钥验证一样，运输商数量的增加导致天然气的增加。 但是，如图14所示，支付结算的成本比争议成本多不到0.2美元。这种增加是合理的，因为在支付结算期间首先拨打PoD合同，然后呼叫是 通过链传播。 但是，在争议期间，呼叫直接从BT合同终端向后传播。

#### Security Analysis

在本小节中，我们描述了对整个系统的潜在威胁和攻击，并讨论了确保满足安全目标的处理技术。通过设计，我们的解决方案继承了区块链的关键安全功能。这些功能包括分散信任，完整性，不可否认性和可用性。我们的系统还通过使用限制修饰符处理智能合约功能的身份验证和访问控制，限制修饰符允许某些参与者执行功能。此外，通过设计，系统可以防止中间人（MITM）攻击以及重放攻击，因为每个消息交换都经过加密签名和时间戳。即使攻击者用他的EA和公钥替换了演员的EA，攻击者也无法正确签名，因为私钥只有合法的演员知道。因此，如果攻击者伪造合法参与者的IP地址或EA地址，则该交易将被拒绝并且合同状态将被恢复。

完整性是一项重要功能，可确保重要信息不会发生数据修改。 PoD系统提供使用日志追溯历史记录事件的功能。区块链的不变性确保了参与方之间所有交换消息的完整性以及创建的日志和生成的事件。不可否认性提供对发件人身份的验证。记录所有函数调用的启动器的以太坊地址，并始终是日志的一部分。所有函数调用都由actor签名。这确保了没有演员可以否认他们的行为。

至于确保可用性，需要注意的是，部署到区块链的智能合约始终可供参与实体执行其功能。这使得系统服务始终可供所有用户使用。所有参与者也可以使用包括已启动的交易，日志和事件在内的历史数据。此外，系统受到保护免受拒绝服务（DoS）攻击，因为所有交易都以分散和分布的方式被记录并存储在公共以太坊分类账中，并且不会遭受失败，黑客攻击或妥协。以太坊公共分类账具有高度可靠性和抗DDoS攻击能力，因为它分布在全球范围内，并受到数以万计的挖掘节点的保护，这些节点以高完整性和一致性托管重复记录和数据。

机密性要求可以通过使用私有或许可的区块链来实现，如多链，超级边界或私有以太坊。在我们的系统中，考虑到买家和卖家未知的事实，我们使用公共以太坊区块链，其中交易以明确的方式传输和存储。对于私有以太坊，交易可以加密，密钥只能由参与的矿工节点和参与者共享。值得注意的是，我们基于区块链的设计减轻了昂贵的公钥基础设施（PKI）在密钥分发中的使用。如[16]中所述，独特的20字节以太网地址（EA）可以立即分配给碰撞概率几乎为零的参与者 - 这是区块链的一个强大功能。 EA带有非对称公钥对，随后可用于加密所有数据和事务。

## Conclusions

在本文中，我们提出了一种基于区块链的交易物理资产交付证明（PoD）解决方案。我们的解决方案利用以太坊区块链的功能实现支付自动化，并提供防篡改的日志和事件，以实现可信的易处理性和透明度。实施的解决方案适用于多个运输商和单个运输商，具有惩罚和激励机制，迫使所有参与者诚实行事。该解决方案还消除了受信任的第三方的需要，并利用智能合约作为托管来自动结算付款，即使存在争议，并且一旦项目成功交付给买方，就给予每个参与者约定的共享。我们的分散式PoD解决方案使用一系列合同，没有循环依赖性，以满足在多个运输商之间交付的需求。我们测试了关键功能，并在考虑多个测试用例场景的情况下展示了正确的行为和结果。我们演示并讨论了我们的解决方案满足声音PoD系统的要求。此外，我们分析了解决方案的安全性，并得出结论，该解决方案能够抵御已知的安全攻击并确实满足网络安全功能和目标。我们的成本分析显示整体系统成本极低，并且随着可以参与全球运输的运输商数量的增加，在0.1-0.2范围内略有增加。两笔交易的成本与所用天然气价格的当前价值成正比。但是，预计成功和不成功交易之间的预期成本差异很小。这表明我们的解决方案具有成本效益，可以作为本地和全球物理资产销售和交易的通用解决方案。至于未来的工作，我们目前正致力于销售数字资产（如在线图书，文档，照片，电影，音乐等）的PoD解决方案，以确保分散，可信和安全的交付和自动支付所有类型的交易资产，无论是实物资产还是数字资产。